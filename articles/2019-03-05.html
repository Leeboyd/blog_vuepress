<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS 設定 (Let&#39;s Encrypt and certbot) | DEV.Boy</title>
    <meta name="description" content="Think twice, code once.">
    <link rel="icon" href="/blog_vuepress/assets/img/icon.png">
    
    <link rel="preload" href="/blog_vuepress/assets/css/0.styles.655d990b.css" as="style"><link rel="preload" href="/blog_vuepress/assets/js/app.c16370cc.js" as="script"><link rel="preload" href="/blog_vuepress/assets/js/9.60ab9a27.js" as="script"><link rel="prefetch" href="/blog_vuepress/assets/js/10.a3bf57f3.js"><link rel="prefetch" href="/blog_vuepress/assets/js/11.2305f366.js"><link rel="prefetch" href="/blog_vuepress/assets/js/12.d914188e.js"><link rel="prefetch" href="/blog_vuepress/assets/js/13.57cea0c3.js"><link rel="prefetch" href="/blog_vuepress/assets/js/14.dfd715d5.js"><link rel="prefetch" href="/blog_vuepress/assets/js/15.9b71fef1.js"><link rel="prefetch" href="/blog_vuepress/assets/js/2.3b2c723b.js"><link rel="prefetch" href="/blog_vuepress/assets/js/3.2922585c.js"><link rel="prefetch" href="/blog_vuepress/assets/js/4.7fd15097.js"><link rel="prefetch" href="/blog_vuepress/assets/js/5.d19ad4b7.js"><link rel="prefetch" href="/blog_vuepress/assets/js/6.c84ca870.js"><link rel="prefetch" href="/blog_vuepress/assets/js/7.7ea9c63e.js"><link rel="prefetch" href="/blog_vuepress/assets/js/8.a87e3793.js">
    <link rel="stylesheet" href="/blog_vuepress/assets/css/0.styles.655d990b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog_vuepress/" class="home-link router-link-active"><img src="/blog_vuepress/assets/img/logo.png" alt="DEV.Boy" class="logo"> <span class="site-name can-hide">DEV.Boy</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog_vuepress/articles/" class="nav-link router-link-active">Articles</a></div><div class="nav-item"><a href="/blog_vuepress/diary.html" class="nav-link">Diary</a></div><div class="nav-item"><a href="/blog_vuepress/about.html" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog_vuepress/articles/" class="nav-link router-link-active">Articles</a></div><div class="nav-item"><a href="/blog_vuepress/diary.html" class="nav-link">Diary</a></div><div class="nav-item"><a href="/blog_vuepress/about.html" class="nav-link">About</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog_vuepress/articles/2019-03-05.html" class="active sidebar-link">Table of Content</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#老方法" class="sidebar-link">老方法</a></li><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#let-s-encrypt" class="sidebar-link">Let's Encrypt</a></li><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#certbot" class="sidebar-link">certbot</a></li><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#憑證維護" class="sidebar-link">憑證維護</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#cron" class="sidebar-link">cron</a></li><li class="sidebar-sub-header"><a href="/blog_vuepress/articles/2019-03-05.html#crontab" class="sidebar-link">crontab</a></li></ul></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="https-設定-let-s-encrypt-and-certbot"><a href="#https-設定-let-s-encrypt-and-certbot" aria-hidden="true" class="header-anchor">#</a> HTTPS 設定 (Let's Encrypt and certbot)</h1> <h5 id="tags-https-cron-nginx"><a href="#tags-https-cron-nginx" aria-hidden="true" class="header-anchor">#</a> tags: <code>https</code>, <code>cron</code>, <code>nginx</code></h5> <h2 id="老方法"><a href="#老方法" aria-hidden="true" class="header-anchor">#</a> 老方法</h2> <p>連結是之前參考過的設定方式，已經夠簡潔，雖然現在有更簡單的方式了，但還是從中可學習到原理</p> <ul><li><a href="https://github.com/diafygi/acme-tiny" target="_blank" rel="noopener noreferrer">acme-tiny<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="let-s-encrypt"><a href="#let-s-encrypt" aria-hidden="true" class="header-anchor">#</a> Let's Encrypt</h2> <p>是一家 Certificate Authority, CA, 免費提供 TLS/SSL 憑證，</p> <div class="tip custom-block"><p class="custom-block-title">Authority</p> <p>一種信任機制，當你向 Authority 註冊某 domain 成功後，Authority 會幫你這句話背書：「你是這個 domain 的擁有者」</p></div> <p>如果想支持他們，可以 <a href="https://letsencrypt.org/donate/" target="_blank" rel="noopener noreferrer">Donate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="certbot"><a href="#certbot" aria-hidden="true" class="header-anchor">#</a> certbot</h2> <p>照著網站做吧</p> <p><img src="https://user-images.githubusercontent.com/44891368/53820889-a8777480-3fa7-11e9-8dbd-3f9a55780186.png" alt></p> <p>簡單說明網站的步驟：</p> <ol><li>Add the certbot respository</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">sudo</span> add-apt-repository ppa:certbot/certbot
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>Install certbot with nginx plugin</li></ol> <pre><code>$ sudo apt-get install certbot python-certbot-nginx 
</code></pre> <ol start="3"><li>Use certbot to get certificate</li></ol> <p>厲害的來了，剛剛裝的 certbot 因為有 nginx 的 plugin，所以執行這一段指令後，會出現一些互動問答，然後 certbot <strong>自動</strong> 幫你編輯好 nginx config 的相關設定，並幫你跟 CA 進行交握，取得憑證。</p> <pre><code>$ sudo certbot --nginx
</code></pre> <blockquote><p>這也是這篇沒有寫要如何編輯 nginx config 的原因，因為 certbot 幫你做完了</p></blockquote> <p>當然如果怕怕的，也可以跟 certbot 說要手動去編輯</p> <pre><code>$ sudo certbot --nginx certonly
</code></pre> <h2 id="憑證維護"><a href="#憑證維護" aria-hidden="true" class="header-anchor">#</a> 憑證維護</h2> <p>Let's Encrypt 憑證 3 個月過期，要怎樣設定自動定期去更新呢？</p> <h3 id="cron"><a href="#cron" aria-hidden="true" class="header-anchor">#</a> cron</h3> <p>根據 <code>man</code>:</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>NAME
       cron - daemon to execute scheduled commands (Vixie Cron)

SYNOPSIS
       cron [-f] [-l] [-L loglevel]

DESCRIPTION
       cron is started automatically from /etc/init.d on entering multi-user runlevels.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>也就是 cron is a daemon which runs at the times of system boot.</p> <p>指令格式：</p> <p><img src="https://smhttp-nex.nexcesscdn.net/803313/static/images/blog/2014-01-30/cron-job.png" alt></p> <p>方便的查詢工具：<a href="https://crontab.guru" target="_blank" rel="noopener noreferrer">crontab.guru<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="crontab"><a href="#crontab" aria-hidden="true" class="header-anchor">#</a> crontab</h3> <p>crontab (CRON TABle) is a file which contains the schedule of cron entries to be run and at specified times.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p> <p>簡單來說，crontab 是一個安排 cronjob 的檔案。</p> <p><img src="https://user-images.githubusercontent.com/44891368/53824975-335c6d00-3fb0-11e9-983c-0cd1ef936c12.png" alt></p> <pre><code># At 00:00 on day-of-month 1 in every 3rd month
00 00 1 */3 * certbot renew
</code></pre> <p>咦？*/3 不是 4 嗎？應該是每四個月吧？不是喔，這裡的邏輯比較像：<code>if (12 % 3 == 0): run_script()</code></p> <div class="tip custom-block"><p class="custom-block-title">不需要 sudo</p> <p>根據 <code>man</code>:</p> <p>NAME
crontab - maintain crontab files for <mark>individual users</mark> (Vixie Cron)</p> <p>每個 user 有自己的 crobtab，權限屬於 user 自己，如果使用 sudo 的話，會要求輸入密碼，這時候自動化執行就會失效了</p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ← <a href="/blog_vuepress/articles/" class="prev router-link-active">
          回文章列表
        </a></span></p></div> <hr class="footnotes-sep"> <section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://stackoverflow.com/questions/21615673/difference-between-cron-crontab-and-cronjob?rq=1" target="_blank" rel="noopener noreferrer">Difference between cron, crontab, and cronjob?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/blog_vuepress/assets/js/app.c16370cc.js" defer></script><script src="/blog_vuepress/assets/js/9.60ab9a27.js" defer></script>
  </body>
</html>
