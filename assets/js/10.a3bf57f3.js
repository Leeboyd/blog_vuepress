(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{64:function(e,t,s){"use strict";s.r(t);var i=s(0),r=Object(i.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),e._m(7),e._v(" "),e._m(8),e._v(" "),e._m(9),e._v(" "),e._m(10),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),e._v(" "),e._m(14),e._v(" "),s("p",[e._v("請注意，如果 Dockerfile 是這樣寫：")]),e._v(" "),e._m(15),e._m(16),e._v(" "),e._m(17),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),e._m(24),e._v(" "),e._m(25),e._m(26),e._v(" "),e._m(27),e._v(" "),e._m(28),e._v(" "),e._m(29),e._v(" "),e._m(30),e._v(" "),e._m(31),e._v(" "),e._m(32),e._v(" "),e._m(33),e._v(" "),e._m(34),e._m(35),e._v(" "),e._m(36),e._v(" "),e._m(37),e._v(" "),e._m(38),e._v(" "),e._m(39),e._m(40),e._v(" "),s("hr",{staticClass:"footnotes-sep"}),e._v(" "),s("section",{staticClass:"footnotes"},[s("ol",{staticClass:"footnotes-list"},[s("li",{staticClass:"footnote-item",attrs:{id:"fn1"}},[s("p",[s("a",{attrs:{href:"https://medium.freecodecamp.org/docker-entrypoint-cmd-dockerfile-best-practices-abc591c30e21",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker ENTRYPOINT & CMD: Dockerfile best practices"),s("OutboundLink")],1),e._v(" "),s("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1"}},[e._v("↩︎")])])])])])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"run-vs-cmd-vs-entrypoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run-vs-cmd-vs-entrypoint","aria-hidden":"true"}},[this._v("#")]),this._v(" RUN vs CMD vs ENTRYPOINT")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h5",{attrs:{id:"tags-docker-dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tags-docker-dockerfile","aria-hidden":"true"}},[this._v("#")]),this._v(" tags: "),t("code",[this._v("docker")]),this._v(", "),t("code",[this._v("Dockerfile")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"摘要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#摘要","aria-hidden":"true"}},[this._v("#")]),this._v(" 摘要")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Dockerfile 中 "),t("code",[this._v("RUN")]),this._v(", "),t("code",[this._v("CMD")]),this._v(" and "),t("code",[this._v("ENTRYPOINT")]),this._v(" 這三個指令常會混淆，故在此做個筆記。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ol",[t("li",[t("p",[t("code",[this._v("RUN")]),this._v(": 會建立一層 image，用於安裝 dependency")])]),this._v(" "),t("li",[t("p",[t("code",[this._v("CMD")]),this._v(", "),t("code",[this._v("ENTRYPOINT")]),this._v(": 容器在啟動時時預設會跑的指令, 兩者有些區別：")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Any command line arguments passed to "),t("code",[this._v("docker run <image>")]),this._v(" will be appended to the "),t("code",[this._v("ENTRYPOINT")]),this._v(",\nand will override all elements using "),t("code",[this._v("CMD")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"shell-格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell-格式","aria-hidden":"true"}},[this._v("#")]),this._v(" shell 格式")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",[t("code",[this._v(" <instruction> command param1\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("當指令執行時，shell 格式底層會呼叫 shell process, 成為 "),t("code",[this._v("/bin/sh -c <command>")]),this._v("，")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("RUN apt-get install jq")]),this._v(" "),t("li",[this._v('CMD echo "Hello, $name"')]),this._v(" "),t("li",[this._v('ENTRYPOINT echo "Hello, $name"')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('ENV name boy\n\nENTRYPOINT echo "Hello, $name"\n')])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("執行 "),t("code",[this._v("docker run <image>")]),this._v(", 會輸出："),t("code",[this._v("Hello, boy")]),this._v(", 因為使用了 shell process 中的環境變數 $name.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"exec-格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#exec-格式","aria-hidden":"true"}},[this._v("#")]),this._v(" exec 格式")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",[t("code",[this._v(' <instruction> ["executable", "param1", "param2", ...]\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v('RUN ["apt-get", "install", "jq"]')]),this._v(" "),t("li",[this._v('CMD ["/bin/sh", "-c", "echo Hello, $name"]')]),this._v(" "),t("li",[this._v('ENTRYPOINT ["/bin/sh", "-c", "echo Hello, $name"]')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('ENV name boy\n\nENTRYPOINT ["/bin/echo", "Hello, $name"]\n')])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("執行 "),t("code",[this._v("docker run <image>")]),this._v(", 會輸出："),t("code",[this._v("Hello, $name")]),this._v(", 如果希望使用環境變數 $name，可修改成")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",[t("code",[this._v('ENTRYPOINT ["/bin/sh", "-c", "echo Hello, $name"]\n')])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("ENTRYPOINT 使用 shell 格式時，會忽略 CMD 和 "),s("code",[e._v("docker run <image>")]),e._v(" 傳入的參數，如果要替換預設指令，需要在 "),s("code",[e._v("docker run <image>")]),e._v(" 時指定 "),s("code",[e._v("--entrypoint")]),e._v("。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"推薦：exec-格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#推薦：exec-格式","aria-hidden":"true"}},[this._v("#")]),this._v(" 推薦：exec 格式")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("指令的可讀性較高，使用 exec 格式時，Docker 不會使用 command shell 解析，而是做為容器的 PID 1, 故可以接收 Unix signal，比如執行 docker stop 時能夠收到 "),t("code",[this._v("SIGTERM")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),t("p",[this._v("ENTRYPOINT 使用 shell 格式時，並非容器的 PID 1, 而是作為 "),t("code",[this._v("/bin/sh -c")]),this._v(" 的子命令，所以不會接收 Unix signal")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"run"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run","aria-hidden":"true"}},[this._v("#")]),this._v(" RUN")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("RUN")]),this._v(" 指令通常用於安裝 depenencies, 會在當前的 image 頂部執行，再疊一個新的 image。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("RUN")]),this._v(" 使用 exec, shell 皆可：")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("RUN apt-get update && apt-get install -y \\\nbzr \\\ngit \\\njq \\\nhtop\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br"),t("span",{staticClass:"line-number"},[this._v("4")]),t("br"),t("span",{staticClass:"line-number"},[this._v("5")]),t("br")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("將 "),s("code",[e._v("apt-get update && apt-get install")]),e._v(" 放在同一個 "),s("code",[e._v("RUN")]),e._v(" 執行，除了可以減少 image 的層數之外，也能夠確保每次安裝的套件都是最新的，如果不同層，"),s("code",[e._v("RUN apt-get update")]),e._v(" 這層可能是使用之前 cache 的。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"cmd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cmd","aria-hidden":"true"}},[this._v("#")]),this._v(" CMD")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("CMD")]),this._v(" (Dockerfile) / "),t("code",[this._v("command")]),this._v(" (docker-compose) 是 container 起動時的預設指令")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("p",[e._v("如果 Dockerfile 有多個 "),s("code",[e._v("CMD")]),e._v(" 只有最後一個會生效。")])]),e._v(" "),s("li",[s("p",[e._v("如果 同時有 "),s("code",[e._v("ENTRYPOINT")]),e._v(" 的話，會在 "),s("code",[e._v("ENTRYPOINT")]),e._v(" 後執行，或作為參數")])]),e._v(" "),s("li",[s("p",[e._v("舉例：")]),e._v(" "),s("ul",[s("li",[e._v('CMD ["executable", "param1", "param2", ...]')]),e._v(" "),s("li",[e._v('或作為參數，CMD ["param1". "param2"]')])])]),e._v(" "),s("li",[s("p",[e._v("override")]),e._v(" "),s("p",[e._v("when specifies arguments after "),s("code",[e._v("docker run <image>")]),e._v(", it will override the default "),s("code",[e._v("CMD")]),e._v("\ndocker run rails_image rails console")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"entrypoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint","aria-hidden":"true"}},[this._v("#")]),this._v(" ENTRYPOINT")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("ENTRYPOINT")]),this._v(" 指令可以讓容器以 process 或 service 的形式運行。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("有 shell 和 exec 兩種格式，有所差異詳見上方說明。")]),this._v(" "),t("li",[t("code",[this._v("CMD")]),this._v(", docker run 傳入的參數會附在 "),t("code",[this._v("ENTRYPOINT")]),this._v(" 之後，前提是使用 exec 格式。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"舉例：cmd-與-entrypoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#舉例：cmd-與-entrypoint","aria-hidden":"true"}},[this._v("#")]),this._v(" 舉例：CMD 與 ENTRYPOINT")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('  ENTRYPOINT ["/bin/echo", "Hello"]\n  CMD ["World"]\n')])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("$ docker run -it [image]")]),this._v(" 輸出為 "),t("code",[this._v("Hello World")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("$ docker run -it [image] boy")]),this._v(" 輸出為 "),t("code",[this._v("Hello boy")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"best-practices"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#best-practices","aria-hidden":"true"}},[this._v("#")]),this._v(" Best Practices"),t("sup",{staticClass:"footnote-ref"},[t("a",{attrs:{href:"#fn1",id:"fnref1"}},[this._v("[1]")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ol",[s("li",[e._v("使用 "),s("code",[e._v("RUN")]),e._v(" 安裝套件，建立 image")]),e._v(" "),s("li",[e._v("如果 image 用途是作為 process 或 service 的容器的話，使用 exec 格式的 "),s("code",[e._v("ENTRYPOINT")]),e._v("，而 "),s("code",[e._v("CMD")]),e._v(" 提供預設參數/flag")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('FROM alpine\nENTRYPOINT ["top", "-b"]\nCMD ["-c"]\n')])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ol",{attrs:{start:"3"}},[t("li",[this._v("如果需要 override "),t("code",[this._v("CMD")]),this._v(", 在 "),t("code",[this._v("docker run <image>")]),this._v(" 時傳入。")])])}],!1,null,null,null);t.default=r.exports}}]);